<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomVault Elite</title>
    <style>
        /* Global Resets and Variables */
        :root {
            --primary-color: #1a2639; /* Deep Slate Blue / Dark Charcoal */
            --secondary-color: #3e4a61; /* Medium Cool Grey-Blue */
            --accent-color: #c19a6b; /* Muted Bronze / Sophisticated Gold */
            --text-light: #f0f0f0;
            --text-dark: #333333;
            --text-muted-light: #a0a0a0;
            --border-color: #55667f; /* A slightly lighter shade for borders on dark backgrounds */

            --font-header: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --font-body: Arial, Helvetica, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--primary-color);
            color: var(--text-light);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .app-container {
            width: 100%;
            max-width: 1400px; /* For web portal view */
            margin: 0 auto;
            padding: 0 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        /* Screen Management */
        .screen {
            display: none;
            flex-grow: 1;
            flex-direction: column;
            animation: fadeIn 0.5s ease-in-out;
        }
        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-header);
            color: var(--text-light);
            margin-bottom: 0.75em;
        }
        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.75rem; }
        p { margin-bottom: 1em; }
        a { color: var(--accent-color); text-decoration: none; }
        a:hover { text-decoration: underline; }

        /* Common Elements */
        .logo {
            font-family: var(--font-header);
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 20px;
            text-align: center;
        }
        .logo-small {
            font-size: 1.5rem;
            color: var(--accent-color);
            font-weight: bold;
        }

        .btn {
            display: inline-block;
            padding: 12px 25px;
            border-radius: 5px;
            font-family: var(--font-header);
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            border: none;
        }
        .btn-primary {
            background-color: var(--accent-color);
            color: var(--primary-color);
        }
        .btn-primary:hover {
            background-color: #d4af8a; /* Lighter accent */
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-light);
            border: 1px solid var(--accent-color);
        }
        .btn-secondary:hover {
            background-color: #4a5870;
            transform: translateY(-2px);
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--secondary-color);
            color: var(--text-light);
            font-family: var(--font-body);
            font-size: 1rem;
        }
        input::placeholder, textarea::placeholder {
            color: var(--text-muted-light);
        }

        .card {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .icon { /* For SVG icons */
            width: 20px;
            height: 20px;
            fill: currentColor; /* Inherits color from parent */
            margin-right: 8px;
            vertical-align: middle;
        }
        .icon-accent { fill: var(--accent-color); }

        /* Utility Classes */
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .d-flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .flex-wrap { flex-wrap: wrap; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }

        /* Header for Logged-in Screens */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
        }
        .app-header nav a {
            margin-left: 20px;
            color: var(--text-light);
        }
        .app-header nav a:hover, .app-header nav a.active {
            color: var(--accent-color);
            text-decoration: underline;
        }
        .app-header .user-greeting {
            color: var(--text-muted-light);
        }

        /* Login Screen */
        #loginScreen {
            justify-content: center;
            align-items: center;
            background: linear-gradient(rgba(26, 38, 57, 0.85), rgba(26, 38, 57, 0.85)), 
                        url('https://images.unsplash.com/photo-1555696964-8f6cf590935a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8bHV4dXJ5JTIwYXJjaGl0ZWN0dXJlfGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60') no-repeat center center / cover;
            /* A subtle luxury texture - replace with a more abstract one if needed */
        }
        .login-container {
            background-color: rgba(30, 45, 68, 0.9); /* Slightly different from primary for depth */
            padding: 40px;
            border-radius: 8px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .login-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            margin-top: 10px;
            margin-bottom: 20px;
            color: var(--text-muted-light);
        }
        .login-options label { display: flex; align-items: center; }
        .login-options input[type="checkbox"] { width: auto; margin-right: 5px; }
        .biometric-login {
            text-align: center;
            margin-top: 20px;
            color: var(--text-muted-light);
        }
        .biometric-login svg {
            width: 30px; height: 30px; fill: var(--accent-color); margin-top: 5px;
        }

        /* Dashboard Screen */
        #dashboardScreen .property-overview-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .property-card {
            border: 1px solid var(--border-color);
            overflow: hidden; /* For image */
        }
        .property-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
        }
        .property-card-content {
            padding: 15px;
        }
        .property-card h4 { margin-bottom: 5px; color: var(--accent-color); }
        .property-card p { font-size: 0.9rem; color: var(--text-muted-light); margin-bottom: 3px; }

        .dashboard-columns {
            display: flex;
            gap: 30px;
        }
        .dashboard-main-column { flex: 2; }
        .dashboard-sidebar-column { flex: 1; }

        .quick-actions { margin-bottom: 30px; }
        .quick-actions .btn { margin-right: 10px; margin-bottom: 10px; }
        
        .activity-feed-item, .upcoming-move-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        .activity-feed-item:last-child, .upcoming-move-item:last-child {
            border-bottom: none;
        }
        .activity-feed-item strong, .upcoming-move-item strong { color: var(--accent-color); }

        .data-visualization-placeholder {
            background-color: var(--secondary-color);
            border: 1px dashed var(--border-color);
            padding: 20px;
            text-align: center;
            color: var(--text-muted-light);
            border-radius: 8px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
        }

        /* Inventory Browser Screen */
        .inventory-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .inventory-search input { width: auto; min-width: 250px; margin-bottom: 0; }
        .view-options button, .filter-toggle-btn {
            background: var(--secondary-color);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 5px;
        }
        .view-options button.active, .filter-toggle-btn.active { background-color: var(--accent-color); color: var(--primary-color); }
        .view-options button svg, .filter-toggle-btn svg { vertical-align: middle; }

        .filter-panel {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            /* display: none; Initially hidden */
        }
        .filter-panel.open { display: block; }
        .filter-group { margin-bottom: 15px; }
        .filter-group label { display: block; margin-bottom: 5px; font-weight: bold; color: var(--accent-color); }
        .filter-group select { margin-bottom: 0; }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .inventory-list-item, .inventory-grid-item {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column; /* For grid item */
            position: relative; /* For checkbox */
        }
        .inventory-list-item {
            flex-direction: row;
            align-items: center;
            gap: 15px;
        }
        .item-thumbnail {
            width: 100px; /* Grid */
            height: 100px; /* Grid */
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px; /* Grid */
        }
        .inventory-list-item .item-thumbnail {
            width: 80px; height: 80px; margin-bottom: 0;
        }
        .item-info h5 { color: var(--text-light); margin-bottom: 5px; }
        .item-info p { font-size: 0.85rem; color: var(--text-muted-light); margin-bottom: 3px; }
        .item-info .item-id { font-size: 0.75rem; color: var(--accent-color); }
        .item-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .inventory-list-item .item-checkbox { position: static; margin-left: auto; }


        /* Item Detail Page */
        #itemDetailScreen .item-detail-layout {
            display: flex;
            gap: 30px;
        }
        .item-gallery { flex: 2; }
        .item-gallery .main-image {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 10px; /* Padding around image within the dark bg */
        }
        .item-thumbnails { display: flex; gap: 10px; overflow-x: auto; }
        .item-thumbnails img {
            width: 80px; height: 80px; object-fit: cover; border-radius: 4px; cursor: pointer;
            border: 2px solid transparent;
        }
        .item-thumbnails img.active, .item-thumbnails img:hover { border-color: var(--accent-color); }

        .item-metadata { flex: 1; }
        .metadata-section { margin-bottom: 20px; }
        .metadata-section h4 { color: var(--accent-color); margin-bottom: 10px; }
        .metadata-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        .metadata-item:last-child { border-bottom: none; }
        .metadata-item strong { color: var(--text-light); }
        .metadata-item span { color: var(--text-muted-light); text-align: right; }
        
        .qr-code-display { margin-top: 20px; text-align: center; }
        .qr-code-display img { width: 120px; height: 120px; background-color: white; padding: 5px; border-radius: 4px;}

        .location-history-timeline { list-style: none; padding-left: 0; }
        .timeline-event {
            padding-left: 25px;
            position: relative;
            border-left: 2px solid var(--accent-color);
            padding-bottom: 15px;
            margin-left: 10px;
        }
        .timeline-event::before { /* Dot on timeline */
            content: '';
            position: absolute;
            left: -7px; /* (12px dot width + 2px border) / 2 */
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--accent-color);
            border: 2px solid var(--primary-color);
        }
        .timeline-event:last-child { border-left: 2px solid transparent; } /* Hide line for last */
        .timeline-date { font-weight: bold; color: var(--text-light); }
        .timeline-details { font-size: 0.9rem; color: var(--text-muted-light); }

        .item-actions .btn { margin-right: 10px; margin-top: 10px; }


        /* Move Request Form */
        #moveRequestScreen .form-section {
            background-color: var(--secondary-color);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .selected-items-preview .item-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .selected-items-preview img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px;}
        .location-selectors { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }


        /* Move Management Screen */
        .move-list-item {
            background-color: var(--secondary-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 5px solid; /* Status color will go here */
        }
        .move-status-requested { border-left-color: #6c757d; } /* Grey */
        .move-status-scheduled { border-left-color: #ffc107; } /* Yellow */
        .move-status-inprogress { border-left-color: var(--accent-color); } /* Gold/Bronze */
        .move-status-completed { border-left-color: #28a745; } /* Green */
        .move-status-cancelled { border-left-color: #dc3545; } /* Red */

        .move-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .move-id { font-weight: bold; font-size: 1.1rem; }
        .move-status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        .move-status-requested .move-status { background-color: #6c757d; }
        .move-status-scheduled .move-status { background-color: #ffc107; }
        .move-status-inprogress .move-status { background-color: var(--accent-color); }
        .move-status-completed .move-status { background-color: #28a745; }
        .move-status-cancelled .move-status { background-color: #dc3545; }
        
        .move-details p { font-size: 0.9rem; margin-bottom: 5px; }
        .move-details strong { color: var(--text-light); }

        /* Property Management Screen */
        #propertyManagementScreen .property-management-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }
        .property-manage-card { /* Similar to dashboard but more details */
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        .property-manage-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .property-manage-card-content { padding: 20px; }
        .property-manage-card h4 { color: var(--accent-color); }
        .property-stats p { font-size: 0.9rem; margin-bottom: 3px; }
        .property-stats strong { color: var(--text-light); }

        /* Mobile Optimizations (Basic) */
        @media (max-width: 768px) {
            .app-container { padding: 0 15px; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.75rem; }
            .app-header { flex-direction: column; align-items: flex-start; gap: 10px; }
            .app-header nav { width: 100%; display: flex; justify-content: space-around; }
            .app-header nav a { margin-left: 0; }

            .dashboard-columns { flex-direction: column; }
            .inventory-controls { flex-direction: column; align-items: stretch; }
            .inventory-search input { width: 100%; }
            .view-options { width: 100%; display: flex; justify-content: space-around; }
            
            #itemDetailScreen .item-detail-layout { flex-direction: column; }
            .location-selectors { grid-template-columns: 1fr; }

            /* Inventory list for mobile */
            .inventory-grid { grid-template-columns: 1fr; /* Force list-like on mobile */ }
            .inventory-grid-item { flex-direction: row; align-items: center; gap: 15px; }
            .inventory-grid-item .item-thumbnail { width: 80px; height: 80px; margin-bottom: 0; }
            .inventory-list-item .item-info { flex-grow: 1; }
        }
        @media (max-width: 480px) {
            .btn { padding: 10px 15px; font-size: 0.9rem; }
            .quick-actions .btn { display: block; width: 100%; margin-bottom: 10px; margin-right: 0; }
        }

    </style>
</head>
<body>
    <div class="app-container">

        <!-- Login Screen -->
        <div id="loginScreen" class="screen active">
            <div class="login-container">
                <div class="logo">HomVault Elite</div>
                <form id="loginForm">
                    <input type="email" id="email" placeholder="Email Address" required value="client@example.com">
                    <input type="password" id="password" placeholder="Password" required value="password123">
                    <div class="login-options">
                        <label><input type="checkbox" id="rememberMe"> Remember Me</label>
                        <a href="#">Forgot Password?</a>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                </form>
                <div class="biometric-login">
                    <p>Or login with Biometrics</p>
                    <!-- Placeholder for Face ID / Touch ID icon -->
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1.5-8.71L12 10l1.5 1.29C13.12 11.58 13 12.15 13 12.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5c0-.35-.12-.92-.5-1.21L14 10l-2-1.59V7h-1v3.71zm-2.5 3.21c.83 0 1.5-.67 1.5-1.5 0-.35-.12-.92-.5-1.21L9 10l-2-1.59V7H6v3.71L7.5 12l1.5 1.29c-.38.29-.5.86-.5 1.21 0 .83.67 1.5 1.5 1.5zM9.5 17c1.38 0 2.5-1.12 2.5-2.5S10.88 12 9.5 12 7 13.12 7 14.5 8.12 17 9.5 17zm5 0c1.38 0 2.5-1.12 2.5-2.5S15.88 12 14.5 12s-2.5 1.12-2.5 2.5 1.12 2.5 2.5 2.5z"/></svg>
                </div>
            </div>
        </div>

        <!-- Client Dashboard Screen -->
        <div id="dashboardScreen" class="screen">
            <header class="app-header">
                <div class="logo-small">HomVault Elite</div>
                <span class="user-greeting">Welcome, <span id="userName">Client</span></span>
                <nav>
                    <a href="#" class="nav-link active" data-target="dashboardScreen">Dashboard</a>
                    <a href="#" class="nav-link" data-target="inventoryBrowserScreen">Inventory</a>
                    <a href="#" class="nav-link" data-target="moveManagementScreen">Moves</a>
                    <a href="#" class="nav-link" data-target="propertyManagementScreen">Properties</a>
                    <a href="#" id="logoutButton">Logout</a>
                </nav>
            </header>
            <main>
                <h2>Client Dashboard</h2>
                
                <section class="quick-actions">
                    <button class="btn btn-primary" data-target="inventoryBrowserScreen">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
                        View Full Inventory
                    </button>
                    <button class="btn btn-primary" data-target="moveRequestScreen">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M17.66 7.93L12 2.27 6.34 7.93a8 8 0 1011.32 0zM12 17.5A5.5 5.5 0 016.5 12H4a8 8 0 002.34 5.93L12 22.27l5.66-4.34A8 8 0 0012 4a8.04 8.04 0 00-2 .31V6.5A5.5 5.5 0 0112 6.5a5.49 5.49 0 014.16 9.34L17.5 17.5zM10 10h4v4h-4z"/></svg>
                        Request a Move
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('inventorySearchInputGlobal').focus()">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        Search My Items
                    </button>
                </section>

                <h3>Property Overview</h3>
                <div class="property-overview-cards" id="dashboardPropertyCards">
                    <!-- Property cards will be injected by JS -->
                </div>

                <div class="dashboard-columns">
                    <div class="dashboard-main-column">
                        <section class="mb-3">
                            <h3>Recent Activity</h3>
                            <div class="card">
                                <ul id="recentActivityFeed" class="list-unstyled">
                                    <!-- Activity items will be injected by JS -->
                                </ul>
                            </div>
                        </section>
                    </div>
                    <div class="dashboard-sidebar-column">
                        <section class="mb-3">
                            <h3>Upcoming Moves</h3>
                            <div class="card">
                                <ul id="upcomingMovesList" class="list-unstyled">
                                    <!-- Upcoming moves will be injected by JS -->
                                </ul>
                            </div>
                        </section>
                        <section>
                             <h3>Item Distribution</h3>
                             <div class="data-visualization-placeholder">
                                 Elegant Donut Chart / Bar Graph Placeholder
                             </div>
                        </section>
                    </div>
                </div>
            </main>
        </div>

        <!-- Inventory Browser Screen -->
        <div id="inventoryBrowserScreen" class="screen">
            <header class="app-header">
                <div class="logo-small">HomVault Elite</div>
                <span class="user-greeting">Welcome, <span class="userNamePlaceholder">Client</span></span>
                <nav>
                    <a href="#" class="nav-link" data-target="dashboardScreen">Dashboard</a>
                    <a href="#" class="nav-link active" data-target="inventoryBrowserScreen">Inventory</a>
                    <a href="#" class="nav-link" data-target="moveManagementScreen">Moves</a>
                    <a href="#" class="nav-link" data-target="propertyManagementScreen">Properties</a>
                    <a href="#" id="logoutButtonInventory" class="logoutButton">Logout</a>
                </nav>
            </header>
            <main>
                <h2>My Inventory</h2>
                <div class="inventory-controls">
                    <div class="inventory-search">
                        <input type="text" id="inventorySearchInputGlobal" placeholder="Search items by name, ID, category...">
                    </div>
                    <div class="d-flex align-center gap-1">
                        <div class="view-options">
                            <button id="gridViewBtn" class="active">
                                <svg class="icon" viewBox="0 0 24 24"><path d="M3 3h8v8H3V3zm0 10h8v8H3v-8zM13 3h8v8h-8V3zm0 10h8v8h-8v-8z"/></svg> Grid
                            </button>
                            <button id="listViewBtn">
                                <svg class="icon" viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg> List
                            </button>
                        </div>
                         <button class="filter-toggle-btn" id="filterToggleBtn">
                            <svg class="icon" viewBox="0 0 24 24"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg> Filters
                        </button>
                    </div>
                </div>

                <div class="filter-panel" id="filterPanelContainer">
                    <h4>Filter By:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="filter-group">
                            <label for="filterProperty">Property</label>
                            <select id="filterProperty"><option value="">All Properties</option></select>
                        </div>
                        <div class="filter-group">
                            <label for="filterRoom">Room</label>
                            <select id="filterRoom"><option value="">All Rooms</option></select>
                        </div>
                        <div class="filter-group">
                            <label for="filterCategory">Category</label>
                            <select id="filterCategory"><option value="">All Categories</option></select>
                        </div>
                        <div class="filter-group">
                            <label for="filterSeasonal">Seasonal Tag</label>
                            <select id="filterSeasonal"><option value="">All Seasons</option></select>
                        </div>
                    </div>
                     <button class="btn btn-secondary btn-small mt-2" id="applyFiltersBtn">Apply Filters</button>
                     <button class="btn btn-link btn-small mt-2" id="clearFiltersBtn" style="color: var(--text-muted-light);">Clear Filters</button>
                </div>
                
                <div id="inventoryDisplay" class="inventory-grid">
                    <!-- Items will be injected by JS -->
                </div>
                <div class="text-center mt-3">
                    <button class="btn btn-primary" id="requestMoveSelectedBtn" style="display:none;">Request Move for Selected (<span id="selectedItemCount">0</span>)</button>
                </div>
            </main>
        </div>

        <!-- Item Detail Page -->
        <div id="itemDetailScreen" class="screen">
            <header class="app-header">
                 <div class="logo-small">HomVault Elite</div>
                 <span class="user-greeting">Welcome, <span class="userNamePlaceholder">Client</span></span>
                 <nav>
                    <a href="#" class="nav-link" data-target="dashboardScreen">Dashboard</a>
                    <a href="#" class="nav-link" data-target="inventoryBrowserScreen">Inventory</a>
                    <a href="#" class="nav-link" data-target="moveManagementScreen">Moves</a>
                    <a href="#" class="nav-link" data-target="propertyManagementScreen">Properties</a>
                    <a href="#" class="logoutButton">Logout</a>
                </nav>
            </header>
            <main>
                <button class="btn btn-secondary mb-2" data-target="inventoryBrowserScreen">← Back to Inventory</button>
                <h2 id="itemNameDetail">Item Name</h2>
                <div class="item-detail-layout">
                    <div class="item-gallery">
                        <img src="https://via.placeholder.com/600x400?text=Main+Item+Image" alt="Main item image" class="main-image" id="itemDetailMainImage">
                        <div class="item-thumbnails" id="itemDetailThumbnails">
                            <!-- Thumbnails will be injected by JS -->
                        </div>
                         <div class="qr-code-display mt-3">
                            <h4>Item QR Code</h4>
                            <img src="https://via.placeholder.com/120?text=QR+Code" alt="QR Code" id="itemDetailQrCode">
                        </div>
                    </div>
                    <div class="item-metadata">
                        <section class="metadata-section">
                            <h4>Details</h4>
                            <div id="itemDetailMetadata">
                                <!-- Metadata items will be injected by JS -->
                            </div>
                        </section>
                        <section class="metadata-section">
                            <h4>Location History</h4>
                            <ul class="location-history-timeline" id="itemDetailLocationHistory">
                                <!-- History events will be injected by JS -->
                            </ul>
                        </section>
                         <section class="metadata-section">
                            <h4>Attached Documents</h4>
                            <div id="itemDetailDocs" class="d-flex gap-1">
                                <!-- Document icons/links -->
                                <a href="#" class="doc-link"><svg class="icon icon-accent" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg> Receipt.pdf</a>
                                <a href="#" class="doc-link"><svg class="icon icon-accent" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg> Warranty.pdf</a>
                            </div>
                        </section>
                    </div>
                </div>
                <div class="item-actions mt-3">
                    <button class="btn btn-primary" id="requestMoveForItemBtn">Request Move for This Item</button>
                    <button class="btn btn-secondary">Edit Item Details (Admin)</button>
                    <button class="btn btn-secondary">View Related Items</button>
                </div>
            </main>
        </div>

        <!-- Move Request Form Screen -->
        <div id="moveRequestScreen" class="screen">
             <header class="app-header">
                 <div class="logo-small">HomVault Elite</div>
                 <span class="user-greeting">Welcome, <span class="userNamePlaceholder">Client</span></span>
                 <nav>
                    <a href="#" class="nav-link" data-target="dashboardScreen">Dashboard</a>
                    <a href="#" class="nav-link" data-target="inventoryBrowserScreen">Inventory</a>
                    <a href="#" class="nav-link" data-target="moveManagementScreen">Moves</a>
                    <a href="#" class="nav-link" data-target="propertyManagementScreen">Properties</a>
                    <a href="#" class="logoutButton">Logout</a>
                </nav>
            </header>
            <main>
                <button class="btn btn-secondary mb-2" data-target="inventoryBrowserScreen">← Cancel</button>
                <h2>Request a Move</h2>
                <form id="moveRequestForm">
                    <div class="form-section">
                        <h3>Items to Move</h3>
                        <div id="moveRequestSelectedItems" class="selected-items-preview">
                            <!-- Selected items preview will be injected by JS -->
                            <p>No items selected. Go to <a href="#" data-target="inventoryBrowserScreen">Inventory</a> to select items.</p>
                        </div>
                         <!-- Option to add items if starting fresh -->
                         <button type="button" class="btn btn-secondary btn-small" data-target="inventoryBrowserScreen">Select Items from Inventory</button>
                    </div>

                    <div class="form-section">
                        <h3>Location</h3>
                        <div class="location-selectors">
                            <div>
                                <label for="moveOriginProperty">Origin Property</label>
                                <select id="moveOriginProperty" required></select>
                                <label for="moveOriginRoom" class="mt-1">Origin Room</label>
                                <input type="text" id="moveOriginRoom" placeholder="E.g., Living Room">
                            </div>
                            <div>
                                <label for="moveDestinationProperty">Destination Property</label>
                                <select id="moveDestinationProperty" required></select>
                                <label for="moveDestinationRoom" class="mt-1">Destination Room</label>
                                <input type="text" id="moveDestinationRoom" placeholder="E.g., Main Bedroom">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Scheduling & Notes</h3>
                        <label for="moveDesiredDate">Desired Move Date</label>
                        <input type="date" id="moveDesiredDate" required>
                        
                        <label for="moveClientNotes" class="mt-1">Client Notes for Designer/Movers</label>
                        <textarea id="moveClientNotes" rows="4" placeholder="Any special instructions..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Submit Move Request</button>
                </form>
            </main>
        </div>

        <!-- Move Management Screen -->
        <div id="moveManagementScreen" class="screen">
            <header class="app-header">
                 <div class="logo-small">HomVault Elite</div>
                 <span class="user-greeting">Welcome, <span class="userNamePlaceholder">Client</span></span>
                 <nav>
                    <a href="#" class="nav-link" data-target="dashboardScreen">Dashboard</a>
                    <a href="#" class="nav-link" data-target="inventoryBrowserScreen">Inventory</a>
                    <a href="#" class="nav-link active" data-target="moveManagementScreen">Moves</a>
                    <a href="#" class="nav-link" data-target="propertyManagementScreen">Properties</a>
                    <a href="#" class="logoutButton">Logout</a>
                </nav>
            </header>
            <main>
                <h2>Move Management</h2>
                <div id="moveListContainer">
                    <!-- Move items will be injected by JS -->
                </div>
            </main>
        </div>
        
        <!-- Property Management Overview Screen -->
        <div id="propertyManagementScreen" class="screen">
            <header class="app-header">
                 <div class="logo-small">HomVault Elite</div>
                 <span class="user-greeting">Welcome, <span class="userNamePlaceholder">Client</span></span>
                 <nav>
                    <a href="#" class="nav-link" data-target="dashboardScreen">Dashboard</a>
                    <a href="#" class="nav-link" data-target="inventoryBrowserScreen">Inventory</a>
                    <a href="#" class="nav-link" data-target="moveManagementScreen">Moves</a>
                    <a href="#" class="nav-link active" data-target="propertyManagementScreen">Properties</a>
                    <a href="#" class="logoutButton">Logout</a>
                </nav>
            </header>
            <main>
                <h2>My Properties</h2>
                <div id="propertyManagementCardsContainer" class="property-management-cards">
                    <!-- Property management cards injected by JS -->
                </div>
            </main>
        </div>


    </div> <!-- .app-container -->

    <script>
        const App = {
            currentScreen: 'loginScreen',
            userName: 'Valued Client', // Default, updated on login
            selectedItemsForMove: [], // Store IDs of items selected for a move
            
            // DUMMY DATA (as provided in thought process, potentially extended)
            data: {
                user: { name: "Jonathan Archer", email: "client@example.com" },
                properties: [
                    { id: "prop1", name: "Park Avenue Residence", address: "740 Park Ave, New York, NY", type: "Apartment", photo: "https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8bHV4dXJ5JTIwaW50ZXJpb3J8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=300&q=60", rooms: 10, itemCount: 120, totalValue: 2500000 },
                    { id: "prop2", name: "Hamptons Beach House", address: "123 Ocean Rd, Southampton, NY", type: "House", photo: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8bHV4dXJ5JTIwaG91c2V8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=300&q=60", rooms: 8, itemCount: 85, totalValue: 1800000 },
                    { id: "prop3", name: "Manhattan Storage Unit", address: "456 Storage Way, New York, NY", type: "Storage", photo: "https://images.unsplash.com/photo-1584720170877-ad356a03d3d1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8c3RvcmFnZSUyMHVuaXR8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=300&q=60", rooms: 1, itemCount: 200, totalValue: 750000 }
                ],
                items: [
                    { id: "ITEM-001", name: "Blue Velvet Sofa", photo: "https://images.unsplash.com/photo-1555041469-a586c61ea9bc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8c29mYXxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=150&q=60", photos: ["https://images.unsplash.com/photo-1555041469-a586c61ea9bc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8c29mYXxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=600&q=60", "https://images.unsplash.com/photo-1540574163024-58c7f690c232?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8c29mYXxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=80&q=60"], qrCode: "https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=ITEM-001", locationId: "prop1", room: "Living Room", category: "Furniture", subcategory: "Seating", description: "A luxurious blue velvet sofa from Roche Bobois. Custom upholstery.", dimensions: "220x100x80cm", weight: "75kg", value: 12000, purchaseDate: "2022-05-10", condition: "Excellent", handling: "Handle with care, cover during transit.", seasonalTags: [], collectionTags: ["Modern Living"], designer: "Roche Bobois", materials: "Velvet, Wood", fragile: false, insured: true, locationHistory: [{date: "2023-01-15", from: "Warehouse", to: "Park Avenue Residence, Living Room"}, {date: "2022-05-10", from: "Roche Bobois Showroom", to: "Warehouse"}] },
                    { id: "ITEM-002", name: "Antique Chinese Vase", photo: "https://images.unsplash.com/photo-1578990753369-1689d5239f18?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8YW50aXF1ZSUyMHZhc2V8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=150&q=60", photos: ["https://images.unsplash.com/photo-1578990753369-1689d5239f18?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8YW50aXF1ZSUyMHZhc2V8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=600&q=60"], qrCode: "https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=ITEM-002", locationId: "prop2", room: "Entrance Hall", category: "Art", subcategory: "Ceramics", description: "Ming Dynasty period vase. Certified authentic.", dimensions: "30x30x60cm", weight: "10kg", value: 85000, purchaseDate: "2020-11-02", condition: "Good (minor chip on base)", handling: "Extremely fragile. Use custom crate. Climate controlled.", seasonalTags: [], collectionTags: ["Antiques", "Asian Art"], designer: "Unknown Ming Artisan", materials: "Porcelain", fragile: true, insured: true, locationHistory: [{date: "2023-03-20", from: "Park Avenue Residence, Study", to: "Hamptons Beach House, Entrance Hall"}] },
                    { id: "ITEM-003", name: "Men's Ski Gear Set", photo: "https://images.unsplash.com/photo-1549609356-85639060069c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8c2tpJTIwZ2VhcnxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=150&q=60", photos: ["https://images.unsplash.com/photo-1549609356-85639060069c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8c2tpJTIwZ2VhcnxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=600&q=60"], qrCode: "https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=ITEM-003", locationId: "prop3", room: "Unit A12", category: "Seasonal Items", subcategory: "Winter Sports", description: "Full set of Salomon skis (QST 106), boots (S/Pro 120), and carbon poles.", dimensions: "180x30x20cm", weight: "15kg", value: 2500, purchaseDate: "2021-12-01", condition: "Very Good", handling: "Standard handling. Store in cool, dry place.", seasonalTags: ["Winter"], collectionTags: ["Sports Equipment"], designer: "Salomon", materials: "Composite, Metal, Plastic", fragile: false, insured: false, locationHistory: [{date: "2023-04-10", from: "Hamptons Beach House, Garage", to: "Manhattan Storage Unit, Unit A12"}] },
                    { id: "ITEM-004", name: "Abstract Oil Painting", photo: "https://images.unsplash.com/photo-1549887552-cb10752caf60?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YWJzdHJhY3QlMjBwYWludGluZ3xlbnwwfHwwfHx8MA&auto=format&fit=crop&w=150&q=60", photos: ["https://images.unsplash.com/photo-1549887552-cb10752caf60?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YWJzdHJhY3QlMjBwYWludGluZ3xlbnwwfHwwfHx8MA&auto=format&fit=crop&w=600&q=60"], qrCode: "https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=ITEM-004", locationId: "prop1", room: "Study", category: "Art", subcategory: "Painting", description: "'Dimensions Unseen' by Eva Rostova. Large canvas.", dimensions: "150x120cm", weight: "8kg", value: 22000, purchaseDate: "2023-02-15", condition: "Excellent", handling: "Handle by edges, climate control preferred.", seasonalTags: [], collectionTags: ["Contemporary Art"], designer: "Eva Rostova", materials: "Oil on Canvas, Wood Frame", fragile: true, insured: true, locationHistory: [{date: "2023-02-20", from: "Gallery", to: "Park Avenue Residence, Study"}] },
                ],
                moves: [
                    { id: "MOVE-001", requestDate: "2023-10-01", scheduledDate: "2023-10-15", origin: { propertyId: "prop1", room: "Living Room"}, destination: { propertyId: "prop2", room: "Guest Bedroom"}, itemIds: ["ITEM-001"], itemCount: 1, status: "Completed", notes: "Please ensure sofa is well-protected." },
                    { id: "MOVE-002", requestDate: "2023-11-05", scheduledDate: "2023-11-20", origin: { propertyId: "prop3", room: "Unit A12"}, destination: { propertyId: "prop1", room: "Storage Closet"}, itemIds: ["ITEM-003"], itemCount: 1, status: "Scheduled", notes: "" },
                    { id: "MOVE-003", requestDate: "2023-11-10", scheduledDate: "N/A", origin: { propertyId: "prop2", room: "Entrance Hall"}, destination: { propertyId: "prop1", room: "Study"}, itemIds: ["ITEM-002"], itemCount: 1, status: "Requested", notes: "Client needs this urgently for an event." }
                ],
                // For filter dropdowns
                rooms: ["Living Room", "Dining Room", "Master Bedroom", "Guest Bedroom", "Study", "Kitchen", "Entrance Hall", "Garage", "Storage Closet", "Unit A12"],
                categories: ["Furniture", "Art", "Books", "Clothing", "Seasonal Items", "Electronics", "Decor"],
                seasonalTagsList: ["Spring", "Summer", "Fall", "Winter", "All-Season"],
            },

            init() {
                // Screen Navigation
                document.querySelectorAll('.nav-link, button[data-target], a[data-target]').forEach(el => {
                    el.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetScreen = e.currentTarget.dataset.target;
                        if (targetScreen) App.navigateTo(targetScreen);
                        
                        // Update active state for nav links
                        if(el.classList.contains('nav-link')) {
                            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                            // Activate current link and its counterparts on other headers
                            document.querySelectorAll(`.nav-link[data-target="${targetScreen}"]`).forEach(activeLink => activeLink.classList.add('active'));
                        }
                    });
                });
                
                // Login
                document.getElementById('loginForm').addEventListener('submit', App.handleLogin);
                document.querySelectorAll('.logoutButton, #logoutButton, #logoutButtonInventory').forEach(btn => {
                    btn.addEventListener('click', App.handleLogout);
                });


                // Inventory Screen Specific
                document.getElementById('gridViewBtn').addEventListener('click', () => App.renderInventoryItems('grid'));
                document.getElementById('listViewBtn').addEventListener('click', () => App.renderInventoryItems('list'));
                document.getElementById('filterToggleBtn').addEventListener('click', App.toggleFilterPanel);
                document.getElementById('applyFiltersBtn').addEventListener('click', () => App.renderInventoryItems(document.querySelector('.view-options .active').id === 'gridViewBtn' ? 'grid' : 'list'));
                document.getElementById('clearFiltersBtn').addEventListener('click', App.clearInventoryFilters);
                document.getElementById('inventorySearchInputGlobal').addEventListener('input', () => App.renderInventoryItems(document.querySelector('.view-options .active').id === 'gridViewBtn' ? 'grid' : 'list'));


                // Move Request Form Specific
                document.getElementById('moveRequestForm').addEventListener('submit', App.handleMoveRequestSubmit);
                document.getElementById('requestMoveSelectedBtn').addEventListener('click', App.initMoveRequestFromSelection);
                document.getElementById('requestMoveForItemBtn').addEventListener('click', App.initMoveRequestFromItemDetail);

                // Populate filter dropdowns
                App.populateFilterDropdowns();
                App.populatePropertyDropdownsForMoveForm();

                // Initial screen check (e.g. if already logged in via session - not implemented here)
                // For now, always start at login.
                App.navigateTo('loginScreen');
            },

            navigateTo(screenId) {
                document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
                const target = document.getElementById(screenId);
                if (target) {
                    target.classList.add('active');
                    App.currentScreen = screenId;
                    window.scrollTo(0,0); // Scroll to top on screen change

                    // Specific actions when navigating to certain screens
                    if (screenId === 'dashboardScreen') App.renderDashboard();
                    if (screenId === 'inventoryBrowserScreen') App.renderInventoryItems();
                    if (screenId === 'moveManagementScreen') App.renderMoveManagementList();
                    if (screenId === 'propertyManagementScreen') App.renderPropertyManagement();
                    if (screenId === 'moveRequestScreen' && App.selectedItemsForMove.length > 0) {
                         App.populateMoveRequestFormWithSelectedItems();
                    } else if (screenId === 'moveRequestScreen') {
                         App.clearMoveRequestFormItems(); // Clear if navigating directly without selection
                    }
                } else {
                    console.error("Screen not found:", screenId);
                }
            },

            handleLogin(e) {
                e.preventDefault();
                // Basic validation placeholder
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                if (email && password) { // In real app, verify credentials
                    App.userName = App.data.user.name; // Use dummy user name
                    document.getElementById('userName').textContent = App.userName;
                    document.querySelectorAll('.userNamePlaceholder').forEach(el => el.textContent = App.userName);
                    App.navigateTo('dashboardScreen');
                } else {
                    alert('Please enter email and password.');
                }
            },
            
            handleLogout(e) {
                e.preventDefault();
                // Clear any session related data if needed
                App.selectedItemsForMove = []; // Clear selected items
                App.navigateTo('loginScreen');
            },

            renderDashboard() {
                // Property Overview Cards
                const propertyCardsContainer = document.getElementById('dashboardPropertyCards');
                propertyCardsContainer.innerHTML = '';
                App.data.properties.slice(0,3).forEach(prop => { // Show first 3 for brevity
                    const card = document.createElement('div');
                    card.className = 'property-card card';
                    card.innerHTML = `
                        <img src="${prop.photo}" alt="${prop.name}">
                        <div class="property-card-content">
                            <h4>${prop.name}</h4>
                            <p>${prop.type}</p>
                            <p>${prop.itemCount} items</p>
                            <p><a href="#" data-target="inventoryBrowserScreen" data-filter-property="${prop.id}">View Items</a></p>
                        </div>
                    `;
                    card.querySelector('a[data-target]').addEventListener('click', (e) => {
                        e.preventDefault();
                        const propId = e.currentTarget.dataset.filterProperty;
                        App.navigateTo('inventoryBrowserScreen');
                        // Pre-select filter if navigating from here
                        setTimeout(() => { // Ensure inventory screen is rendered
                           document.getElementById('filterProperty').value = propId;
                           App.renderInventoryItems();
                        }, 0);
                    });
                    propertyCardsContainer.appendChild(card);
                });

                // Recent Activity
                const activityFeed = document.getElementById('recentActivityFeed');
                activityFeed.innerHTML = '';
                // Example: combine item location history and move updates
                let recentActivities = [];
                App.data.items.forEach(item => {
                    item.locationHistory.slice(0,1).forEach(hist => { // Take most recent history
                        recentActivities.push({ date: hist.date, text: `Moved: <strong>${item.name}</strong> to ${hist.to}` });
                    });
                });
                App.data.moves.forEach(move => {
                     recentActivities.push({ date: move.requestDate, text: `Status Update: Move ID <strong>${move.id}</strong> is ${move.status}` });
                });
                recentActivities.sort((a,b) => new Date(b.date) - new Date(a.date)); // Sort by date desc

                recentActivities.slice(0, 5).forEach(activity => { // Show top 5
                    const li = document.createElement('li');
                    li.className = 'activity-feed-item';
                    li.innerHTML = `${new Date(activity.date).toLocaleDateString()}: ${activity.text}`;
                    activityFeed.appendChild(li);
                });
                if (recentActivities.length === 0) activityFeed.innerHTML = '<li class="text-muted-light">No recent activity.</li>';


                // Upcoming Moves
                const upcomingMovesList = document.getElementById('upcomingMovesList');
                upcomingMovesList.innerHTML = '';
                const upcoming = App.data.moves.filter(m => m.status === 'Scheduled' || m.status === 'Requested')
                                    .sort((a,b) => new Date(a.scheduledDate || a.requestDate) - new Date(b.scheduledDate || b.requestDate));
                upcoming.slice(0, 3).forEach(move => { // Show top 3
                    const li = document.createElement('li');
                    li.className = 'upcoming-move-item';
                    const destinationProperty = App.data.properties.find(p => p.id === move.destination.propertyId);
                    li.innerHTML = `<strong>${move.scheduledDate !== "N/A" ? new Date(move.scheduledDate).toLocaleDateString() : "Pending"}</strong>: ${move.itemCount} item(s) to ${destinationProperty ? destinationProperty.name : 'Unknown'}`;
                    upcomingMovesList.appendChild(li);
                });
                if (upcoming.length === 0) upcomingMovesList.innerHTML = '<li class="text-muted-light">No upcoming moves.</li>';
            },
            
            populateFilterDropdowns() {
                const propSelect = document.getElementById('filterProperty');
                App.data.properties.forEach(p => propSelect.add(new Option(p.name, p.id)));

                const roomSelect = document.getElementById('filterRoom');
                App.data.rooms.forEach(r => roomSelect.add(new Option(r, r)));

                const catSelect = document.getElementById('filterCategory');
                App.data.categories.forEach(c => catSelect.add(new Option(c, c)));

                const seasonSelect = document.getElementById('filterSeasonal');
                App.data.seasonalTagsList.forEach(s => seasonSelect.add(new Option(s, s)));
            },

            clearInventoryFilters() {
                document.getElementById('filterProperty').value = "";
                document.getElementById('filterRoom').value = "";
                document.getElementById('filterCategory').value = "";
                document.getElementById('filterSeasonal').value = "";
                document.getElementById('inventorySearchInputGlobal').value = "";
                App.renderInventoryItems(document.querySelector('.view-options .active').id === 'gridViewBtn' ? 'grid' : 'list');
            },

            toggleFilterPanel() {
                const panel = document.getElementById('filterPanelContainer');
                const btn = document.getElementById('filterToggleBtn');
                panel.style.display = (panel.style.display === 'none' || panel.style.display === '') ? 'block' : 'none';
                btn.classList.toggle('active', panel.style.display === 'block');
            },

            renderInventoryItems(viewType = 'grid') {
                const displayContainer = document.getElementById('inventoryDisplay');
                const gridBtn = document.getElementById('gridViewBtn');
                const listBtn = document.getElementById('listViewBtn');

                displayContainer.className = viewType === 'grid' ? 'inventory-grid' : 'inventory-list';
                gridBtn.classList.toggle('active', viewType === 'grid');
                listBtn.classList.toggle('active', viewType === 'list');
                
                displayContainer.innerHTML = ''; // Clear previous items

                // Filter logic
                const searchTerm = document.getElementById('inventorySearchInputGlobal').value.toLowerCase();
                const filterProp = document.getElementById('filterProperty').value;
                const filterRoom = document.getElementById('filterRoom').value;
                const filterCat = document.getElementById('filterCategory').value;
                const filterSeason = document.getElementById('filterSeasonal').value;

                let filteredItems = App.data.items.filter(item => {
                    const nameMatch = item.name.toLowerCase().includes(searchTerm);
                    const idMatch = item.id.toLowerCase().includes(searchTerm);
                    const catMatch = item.category.toLowerCase().includes(searchTerm);
                    const searchMatch = searchTerm === '' || nameMatch || idMatch || catMatch;

                    const propMatch = filterProp === '' || item.locationId === filterProp;
                    const roomMatch = filterRoom === '' || item.room === filterRoom;
                    const catFilterMatch = filterCat === '' || item.category === filterCat;
                    const seasonMatch = filterSeason === '' || (item.seasonalTags && item.seasonalTags.includes(filterSeason));
                    
                    return searchMatch && propMatch && roomMatch && catFilterMatch && seasonMatch;
                });


                if (filteredItems.length === 0) {
                    displayContainer.innerHTML = '<p class="text-muted-light text-center" style="grid-column: 1 / -1;">No items match your criteria.</p>';
                    App.updateSelectedCount();
                    return;
                }

                filteredItems.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = viewType === 'grid' ? 'inventory-grid-item' : 'inventory-list-item';
                    const property = App.data.properties.find(p => p.id === item.locationId);
                    
                    itemElement.innerHTML = `
                        <input type="checkbox" class="item-checkbox" data-item-id="${item.id}" ${App.selectedItemsForMove.includes(item.id) ? 'checked' : ''}>
                        <img src="${item.photo}" alt="${item.name}" class="item-thumbnail">
                        <div class="item-info">
                            <h5>${item.name}</h5>
                            <p class="item-id">ID: ${item.id}</p>
                            <p>Location: ${property ? property.name : 'N/A'}${item.room ? ', ' + item.room : ''}</p>
                            <p>Category: ${item.category}</p>
                        </div>
                    `;
                    // Make item clickable to go to detail page (except checkbox)
                    itemElement.addEventListener('click', (e) => {
                        if (e.target.type !== 'checkbox') {
                            App.navigateToItemDetail(item.id);
                        }
                    });
                    itemElement.querySelector('.item-checkbox').addEventListener('change', App.handleItemSelection);
                    displayContainer.appendChild(itemElement);
                });
                App.updateSelectedCount();
            },

            handleItemSelection(e) {
                const itemId = e.target.dataset.itemId;
                if (e.target.checked) {
                    if (!App.selectedItemsForMove.includes(itemId)) {
                        App.selectedItemsForMove.push(itemId);
                    }
                } else {
                    App.selectedItemsForMove = App.selectedItemsForMove.filter(id => id !== itemId);
                }
                App.updateSelectedCount();
            },

            updateSelectedCount() {
                const count = App.selectedItemsForMove.length;
                document.getElementById('selectedItemCount').textContent = count;
                document.getElementById('requestMoveSelectedBtn').style.display = count > 0 ? 'inline-block' : 'none';
            },
            
            navigateToItemDetail(itemId) {
                const item = App.data.items.find(i => i.id === itemId);
                if (!item) return;

                App.currentItemDetailId = itemId; // Store for move request button

                document.getElementById('itemNameDetail').textContent = item.name;
                document.getElementById('itemDetailMainImage').src = item.photos && item.photos.length > 0 ? item.photos[0] : item.photo;
                document.getElementById('itemDetailQrCode').src = item.qrCode;

                const thumbnailsContainer = document.getElementById('itemDetailThumbnails');
                thumbnailsContainer.innerHTML = '';
                if (item.photos && item.photos.length > 1) {
                    item.photos.forEach((pUrl, index) => {
                        const img = document.createElement('img');
                        img.src = pUrl;
                        img.alt = `View ${index+1}`;
                        if (index === 0) img.classList.add('active');
                        img.addEventListener('click', () => {
                            document.getElementById('itemDetailMainImage').src = pUrl;
                            thumbnailsContainer.querySelectorAll('img').forEach(i => i.classList.remove('active'));
                            img.classList.add('active');
                        });
                        thumbnailsContainer.appendChild(img);
                    });
                } else { // if only one photo (or from main item.photo)
                     const img = document.createElement('img');
                        img.src = item.photo;
                        img.alt = `View 1`;
                        img.classList.add('active');
                        thumbnailsContainer.appendChild(img);
                }


                const metadataContainer = document.getElementById('itemDetailMetadata');
                metadataContainer.innerHTML = '';
                const md = (label, value) => value ? `<div class="metadata-item"><strong>${label}:</strong> <span>${value}</span></div>` : '';
                const property = App.data.properties.find(p => p.id === item.locationId);

                metadataContainer.innerHTML = `
                    ${md('Unique ID', item.id)}
                    ${md('Description', item.description)}
                    ${md('Category', `${item.category} ${item.subcategory ? '('+item.subcategory+')' : ''}`)}
                    ${md('Current Location', `${property ? property.name : 'N/A'}${item.room ? ', ' + item.room : ''}`)}
                    ${md('Dimensions', item.dimensions)}
                    ${md('Weight', item.weight)}
                    ${md('Value', item.value ? '$' + item.value.toLocaleString() : 'N/A')}
                    ${md('Purchase Date', item.purchaseDate ? new Date(item.purchaseDate).toLocaleDateString() : 'N/A')}
                    ${md('Condition', item.condition)}
                    ${md('Handling Instructions', item.handling)}
                    ${md('Seasonal Tags', item.seasonalTags && item.seasonalTags.length > 0 ? item.seasonalTags.join(', ') : 'None')}
                    ${md('Collection Tags', item.collectionTags && item.collectionTags.length > 0 ? item.collectionTags.join(', ') : 'None')}
                    ${md('Designer/Manufacturer', item.designer)}
                    ${md('Materials', item.materials)}
                    ${md('Fragile', item.fragile ? 'Yes' : 'No')}
                    ${md('Insured', item.insured ? 'Yes' : 'No')}
                `;

                const historyContainer = document.getElementById('itemDetailLocationHistory');
                historyContainer.innerHTML = '';
                if (item.locationHistory && item.locationHistory.length > 0) {
                    item.locationHistory.forEach(event => {
                        const li = document.createElement('li');
                        li.className = 'timeline-event';
                        li.innerHTML = `
                            <div class="timeline-date">${new Date(event.date).toLocaleDateString()}</div>
                            <div class="timeline-details">Moved from ${event.from} to ${event.to}</div>
                        `;
                        historyContainer.appendChild(li);
                    });
                } else {
                    historyContainer.innerHTML = '<li class="text-muted-light">No location history available.</li>';
                }
                
                App.navigateTo('itemDetailScreen');
            },

            populatePropertyDropdownsForMoveForm() {
                const originSelect = document.getElementById('moveOriginProperty');
                const destSelect = document.getElementById('moveDestinationProperty');
                originSelect.innerHTML = '<option value="">Select Origin Property</option>';
                destSelect.innerHTML = '<option value="">Select Destination Property</option>';

                App.data.properties.forEach(p => {
                    originSelect.add(new Option(p.name, p.id));
                    destSelect.add(new Option(p.name, p.id));
                });
            },
            
            initMoveRequestFromSelection() {
                if (App.selectedItemsForMove.length > 0) {
                    App.navigateTo('moveRequestScreen');
                    // populateMoveRequestFormWithSelectedItems will be called by navigateTo
                } else {
                    alert("Please select items from the inventory first.");
                }
            },

            initMoveRequestFromItemDetail() {
                if (App.currentItemDetailId) {
                    App.selectedItemsForMove = [App.currentItemDetailId]; // Set this as the only selected item
                    App.navigateTo('moveRequestScreen');
                    // populateMoveRequestFormWithSelectedItems will be called by navigateTo
                }
            },

            populateMoveRequestFormWithSelectedItems() {
                const container = document.getElementById('moveRequestSelectedItems');
                container.innerHTML = '';
                if (App.selectedItemsForMove.length === 0) {
                     container.innerHTML = '<p>No items selected. Go to <a href="#" data-target="inventoryBrowserScreen">Inventory</a> to select items.</p>';
                     container.querySelector('a').addEventListener('click', (e) => { e.preventDefault(); App.navigateTo('inventoryBrowserScreen'); });
                     return;
                }
                App.selectedItemsForMove.forEach(itemId => {
                    const item = App.data.items.find(i => i.id === itemId);
                    if (item) {
                        const div = document.createElement('div');
                        div.className = 'item-preview';
                        div.innerHTML = `<img src="${item.photo}" alt="${item.name}"> <span>${item.name} (ID: ${item.id})</span>`;
                        container.appendChild(div);
                    }
                });
            },
            clearMoveRequestFormItems() {
                const container = document.getElementById('moveRequestSelectedItems');
                container.innerHTML = '<p>No items selected. Go to <a href="#" data-target="inventoryBrowserScreen">Inventory</a> to select items.</p>';
                container.querySelector('a').addEventListener('click', (e) => { e.preventDefault(); App.navigateTo('inventoryBrowserScreen'); });
            },

            handleMoveRequestSubmit(e) {
                e.preventDefault();
                const originProp = document.getElementById('moveOriginProperty').value;
                const destProp = document.getElementById('moveDestinationProperty').value;
                const date = document.getElementById('moveDesiredDate').value;

                if (App.selectedItemsForMove.length === 0) {
                    alert('Please select items to move.'); return;
                }
                if (!originProp || !destProp || !date) {
                    alert('Please fill in all required fields (Origin, Destination, Date).'); return;
                }
                if (originProp === destProp && document.getElementById('moveOriginRoom').value === document.getElementById('moveDestinationRoom').value) {
                    alert('Origin and Destination cannot be identical including room.'); return;
                }

                // Simulate submission
                const newMoveId = "MOVE-" + String(App.data.moves.length + 1).padStart(3, '0');
                App.data.moves.push({
                    id: newMoveId,
                    requestDate: new Date().toISOString().split('T')[0],
                    scheduledDate: "N/A", // Or use desiredDate if auto-scheduling
                    origin: { propertyId: originProp, room: document.getElementById('moveOriginRoom').value },
                    destination: { propertyId: destProp, room: document.getElementById('moveDestinationRoom').value },
                    itemIds: [...App.selectedItemsForMove],
                    itemCount: App.selectedItemsForMove.length,
                    status: "Requested",
                    notes: document.getElementById('moveClientNotes').value
                });

                alert(`Move Request ${newMoveId} Submitted!`);
                App.selectedItemsForMove = []; // Clear selection
                document.getElementById('moveRequestForm').reset();
                App.updateSelectedCount(); // To hide button on inventory if visible
                App.navigateTo('moveManagementScreen');
            },

            renderMoveManagementList() {
                const container = document.getElementById('moveListContainer');
                container.innerHTML = '';
                if (App.data.moves.length === 0) {
                    container.innerHTML = '<p class="text-muted-light">No moves recorded yet.</p>';
                    return;
                }

                // Sort moves: active first (Requested, Scheduled, InProgress), then by date (most recent first)
                const statusOrder = { "Requested": 1, "Scheduled": 2, "InProgress": 3, "Completed": 4, "Cancelled": 5 };
                const sortedMoves = [...App.data.moves].sort((a, b) => {
                    if (statusOrder[a.status] !== statusOrder[b.status]) {
                        return statusOrder[a.status] - statusOrder[b.status];
                    }
                    // For same status, sort by scheduled/request date descending
                    const dateA = new Date(a.scheduledDate !== "N/A" ? a.scheduledDate : a.requestDate);
                    const dateB = new Date(b.scheduledDate !== "N/A" ? b.scheduledDate : b.requestDate);
                    return dateB - dateA;
                });


                sortedMoves.forEach(move => {
                    const div = document.createElement('div');
                    const origin = App.data.properties.find(p => p.id === move.origin.propertyId);
                    const destination = App.data.properties.find(p => p.id === move.destination.propertyId);
                    const statusClass = `move-status-${move.status.toLowerCase().replace(/\s+/g, '')}`;
                    div.className = `move-list-item ${statusClass}`;
                    div.innerHTML = `
                        <div class="move-header">
                            <span class="move-id">${move.id}</span>
                            <span class="move-status">${move.status}</span>
                        </div>
                        <div class="move-details">
                            <p><strong>Requested:</strong> ${new Date(move.requestDate).toLocaleDateString()}</p>
                            <p><strong>Scheduled:</strong> ${move.scheduledDate !== "N/A" ? new Date(move.scheduledDate).toLocaleDateString() : 'Pending'}</p>
                            <p><strong>From:</strong> ${origin ? origin.name : 'N/A'} ${move.origin.room ? '('+move.origin.room+')' : ''}</p>
                            <p><strong>To:</strong> ${destination ? destination.name : 'N/A'} ${move.destination.room ? '('+move.destination.room+')' : ''}</p>
                            <p><strong>Items:</strong> ${move.itemCount}</p>
                            ${move.notes ? `<p><strong>Notes:</strong> ${move.notes}</p>` : ''}
                        </div>
                        <button class="btn btn-secondary btn-small mt-2" onclick="App.viewMoveDetails('${move.id}')">View Details</button>
                    `;
                    container.appendChild(div);
                });
            },
            
            viewMoveDetails(moveId) { // Placeholder for actual detail view
                const move = App.data.moves.find(m => m.id === moveId);
                if(move) {
                    let itemNames = "Items: ";
                    if(move.itemIds && move.itemIds.length > 0){
                        itemNames += move.itemIds.map(id => App.data.items.find(i => i.id === id)?.name || 'Unknown Item').join(', ');
                    } else {
                        itemNames += "Details not available.";
                    }
                    alert(`Move Details for ${moveId}:\nStatus: ${move.status}\nFrom: ${move.origin.propertyId} (${move.origin.room})\nTo: ${move.destination.propertyId} (${move.destination.room})\n${itemNames}\nNotes: ${move.notes || 'None'}`);
                }
            },

            renderPropertyManagement() {
                const container = document.getElementById('propertyManagementCardsContainer');
                container.innerHTML = '';
                App.data.properties.forEach(prop => {
                    const card = document.createElement('div');
                    card.className = 'property-manage-card card'; // Re-use card for consistent base
                    card.innerHTML = `
                        <img src="${prop.photo}" alt="${prop.name}">
                        <div class="property-manage-card-content">
                            <h4>${prop.name}</h4>
                            <p class="text-muted-light">${prop.address}</p>
                            <div class="property-stats mt-2">
                                <p><strong>Type:</strong> ${prop.type}</p>
                                <p><strong>Rooms:</strong> ${prop.rooms}</p>
                                <p><strong>Item Count:</strong> ${prop.itemCount}</p>
                                <p><strong>Est. Value:</strong> $${prop.totalValue.toLocaleString()}</p>
                            </div>
                            <button class="btn btn-secondary btn-small mt-2" data-target="inventoryBrowserScreen" data-filter-property="${prop.id}">View Items at this Property</button>
                        </div>
                    `;
                    card.querySelector('button[data-target]').addEventListener('click', (e) => {
                        e.preventDefault();
                        const propId = e.currentTarget.dataset.filterProperty;
                        App.navigateTo('inventoryBrowserScreen');
                         setTimeout(() => {
                           document.getElementById('filterProperty').value = propId;
                           App.renderInventoryItems();
                        }, 0);
                    });
                    container.appendChild(card);
                });
            }
        };

        document.addEventListener('DOMContentLoaded', App.init);
    </script>
</body>
</html>
